{% comment %}
  Product Recommendations Component
  Usage: {% render 'product-recommendations', product: product %}
{% endcomment %}

<div class="product-recommendations max-w-7xl mx-auto px-4">
  <h2 class="text-2xl font-bold text-center mb-8 uppercase">You May Also Like</h2>
  
  <!-- Swiper Container -->
  <div class="swiper recommendations-swiper">
    <div class="swiper-wrapper">
      <!-- Try multiple fallback methods -->
      {% assign related_products = blank %}
      
      <!-- Method 1: From first collection -->
      {% if product.collections.size > 0 %}
        {% assign first_collection = product.collections.first %}
        {% assign related_products = first_collection.products | where: 'id', '!=', product.id | limit: 8 %}
      {% endif %}
      
      <!-- Method 2: If no collection products, get any 8 products -->
      {% if related_products.size == 0 %}
        {% assign related_products = collections.all.products | where: 'id', '!=', product.id | limit: 8 %}
      {% endif %}
      
      <!-- Method 3: If still empty, get first 8 products from shop -->
      {% if related_products.size == 0 %}
        {% assign related_products = collections.all.products | limit: 8 %}
      {% endif %}
      
      {% for related_product in related_products %}
        {% render 'product-card-carousel', product: related_product %}
      {% endfor %}
    </div>
    
    <!-- Navigation buttons -->
    <div class="swiper-button-next"></div>
    <div class="swiper-button-prev"></div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Initialize Swiper for recommendations
  const recommendationsSwiper = new Swiper('.recommendations-swiper', {
    slidesPerView: 'auto',
    spaceBetween: 8,
    navigation: {
      nextEl: '.swiper-button-next',
      prevEl: '.swiper-button-prev',
    },
    breakpoints: {
      640: {
        slidesPerView: 2,
        spaceBetween: 16,
      },
      768: {
        slidesPerView: 3,
        spaceBetween: 16,
      },
      1024: {
        slidesPerView: 4,
        spaceBetween: 24,
      },
    }
  });
});
</script>
