{% comment %}
Price Range Slider Component
Usage: {% render 'price-range-slider', min_price: 0, max_price: 10000 %}
{% endcomment %}

{% assign min_price = min_price | default: 0 %}
{% assign max_price = max_price | default: 10000 %}

<div class="price-range-slider">
  <h4 class="text-sm font-medium text-gray-700 mb-3">Price Range</h4>
  
  <div class="mb-4">
    <div class="flex justify-between text-xs text-gray-500 mb-2">
      <span id="min-display">₹<span id="min-value">{{ min_price }}</span></span>
      <span id="max-display">₹<span id="max-value">{{ max_price }}</span></span>
    </div>
    
    <div class="relative">
      <div class="h-2 bg-gray-200 rounded-full relative">
        <div id="range-fill" class="absolute h-2 bg-black rounded-full"></div>
      </div>
      
      <input type="range" 
             id="range-min" 
             min="{{ min_price }}" 
             max="{{ max_price }}" 
             value="{{ min_price }}"
             class="absolute top-0 w-full h-2 bg-transparent appearance-none cursor-pointer range-slider">
      
      <input type="range" 
             id="range-max" 
             min="{{ min_price }}" 
             max="{{ max_price }}" 
             value="{{ max_price }}"
             class="absolute top-0 w-full h-2 bg-transparent appearance-none cursor-pointer range-slider">
    </div>
  </div>
  
  <div class="flex gap-2 text-sm">
    <input type="number" 
           id="input-min" 
           value="{{ min_price }}"
           min="{{ min_price }}"
           max="{{ max_price }}"
           class="w-full px-2 py-1 border border-gray-300 rounded text-center">
    <span class="self-center text-gray-500">-</span>
    <input type="number" 
           id="input-max" 
           value="{{ max_price }}"
           min="{{ min_price }}"
           max="{{ max_price }}"
           class="w-full px-2 py-1 border border-gray-300 rounded text-center">
  </div>
</div>

<style>
.range-slider {
  -webkit-appearance: none;
  appearance: none;
  background: transparent;
  outline: none;
  pointer-events: none;
}

.range-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  height: 18px;
  width: 18px;
  border-radius: 50%;
  background: #000;
  border: 2px solid #fff;
  box-shadow: 0 2px 4px rgba(0,0,0,0.3);
  cursor: pointer;
  pointer-events: auto;
}

.range-slider::-moz-range-thumb {
  height: 18px;
  width: 18px;
  border-radius: 50%;
  background: #000;
  border: 2px solid #fff;
  box-shadow: 0 2px 4px rgba(0,0,0,0.3);
  cursor: pointer;
  pointer-events: auto;
}
</style>

<script>
(function() {
  const rangeMin = document.getElementById('range-min');
  const rangeMax = document.getElementById('range-max');
  const inputMin = document.getElementById('input-min');
  const inputMax = document.getElementById('input-max');
  const minValue = document.getElementById('min-value');
  const maxValue = document.getElementById('max-value');
  const rangeFill = document.getElementById('range-fill');
  
  const priceGap = 100;
  const minPrice = {{ min_price }};
  const maxPrice = {{ max_price }};
  
  function updateSlider() {
    const minVal = parseInt(rangeMin.value);
    const maxVal = parseInt(rangeMax.value);
    
    if (maxVal - minVal < priceGap) {
      if (event.target === rangeMin) {
        rangeMin.value = maxVal - priceGap;
      } else {
        rangeMax.value = minVal + priceGap;
      }
    }
    
    const minPercent = ((rangeMin.value - minPrice) / (maxPrice - minPrice)) * 100;
    const maxPercent = ((rangeMax.value - minPrice) / (maxPrice - minPrice)) * 100;
    
    rangeFill.style.left = minPercent + '%';
    rangeFill.style.width = (maxPercent - minPercent) + '%';
    
    minValue.textContent = rangeMin.value;
    maxValue.textContent = rangeMax.value;
    inputMin.value = rangeMin.value;
    inputMax.value = rangeMax.value;
    
    // Trigger product filtering
    filterProductsByPrice();
  }
  
  function filterProductsByPrice() {
    const products = document.querySelectorAll('.product-card-enhanced');
    const minVal = parseInt(rangeMin.value);
    const maxVal = parseInt(rangeMax.value);
    
    products.forEach(product => {
      const productPrice = parseFloat(product.dataset.price);
      const matchesPrice = productPrice >= minVal && productPrice <= maxVal;
      
      if (matchesPrice) {
        product.style.display = 'block';
      } else {
        product.style.display = 'none';
      }
    });
  }
  
  rangeMin.addEventListener('input', updateSlider);
  rangeMax.addEventListener('input', updateSlider);
  
  inputMin.addEventListener('input', function() {
    const val = Math.max(minPrice, Math.min(this.value, rangeMax.value - priceGap));
    rangeMin.value = val;
    updateSlider();
  });
  
  inputMax.addEventListener('input', function() {
    const val = Math.min(maxPrice, Math.max(this.value, rangeMin.value + priceGap));
    rangeMax.value = val;
    updateSlider();
  });
  
  updateSlider();
})();
</script>
