{% comment %}
Product Recommendations Section
Usage: Add this section to product templates
{% endcomment %}

<section class="w-full">
  <div class="product-recommendations max-w-7xl mx-auto my-16">
    <h2 class="text-2xl font-bold text-center mb-8 uppercase">{{ section.settings.heading | default: 'You May Also Like'
      }}</h2>

    <!-- Swiper Container -->
    <div class="swiper recommendations-swiper">
      <div class="swiper-wrapper">
        <!-- Try multiple fallback methods -->
        {% assign related_products = blank %}

        <!-- Method 1: From first collection -->
        {% if product.collections.size > 0 %}
        {% assign first_collection = product.collections.first %}
        {% assign related_products = first_collection.products | where: 'id', '!=', product.id | limit:
        section.settings.products_limit %}
        {% endif %}

        <!-- Method 2: If no collection products, get any products -->
        {% if related_products.size == 0 %}
        {% assign related_products = collections.all.products | where: 'id', '!=', product.id | limit:
        section.settings.products_limit %}
        {% endif %}

        <!-- Method 3: If still empty, get first products from shop -->
        {% if related_products.size == 0 %}
        {% assign related_products = collections.all.products | limit: section.settings.products_limit %}
        {% endif %}

        {% for related_product in related_products %}
        {% render 'product-card-carousel', product: related_product %}
        {% endfor %}
      </div>

      <!-- Navigation buttons -->
      {% if section.settings.show_navigation %}
      <div class="swiper-button-next"></div>
      <div class="swiper-button-prev"></div>
      {% endif %}
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    new Swiper('.recommendations-swiper', {
      slidesPerView: 'auto',
      spaceBetween: 0,
      loop: true,
      {% if section.settings.autoplay %}
      autoplay: {
    delay: 3000,
    disableOnInteraction: false,
  },
    {% endif %}
    {% if section.settings.show_navigation %}
  navigation: {
    nextEl: '.swiper-button-next',
      prevEl: '.swiper-button-prev',
      },
  {% endif %}
  breakpoints: {
    640: {
      slidesPerView: 3,
        },
    768: {
      slidesPerView: 4,
        },
    1024: {
      slidesPerView: '{{ section.settings.slides_per_view }}',
        }
  }
    });
  });
</script>

{% schema %}
{
"name": "Product Recommendations",
"settings": [
{
"type": "text",
"id": "heading",
"label": "Heading",
"default": "You May Also Like"
},
{
"type": "range",
"id": "products_limit",
"label": "Number of products",
"min": 4,
"max": 12,
"default": 8
},
{
"type": "checkbox",
"id": "show_navigation",
"label": "Show navigation arrows",
"default": false
}
],
"presets": [
{
"name": "Product Recommendations"
}
]
}
{% endschema %}