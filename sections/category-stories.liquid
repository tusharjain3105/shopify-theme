{% assign default_categories = 'Electronics,Fashion,Home & Garden,Sports,Books,Beauty,Toys,Automotive' | split: ',' %}

<section class="md:hidden py-4">
  <div class="category-carousel overflow-x-auto p-4">
    <div class="category-track flex gap-4">
      {% if section.blocks.size > 0 %}
      {% for block in section.blocks %}
      <div class="category-item flex-shrink-0 w-20">
        <a href="{{ block.settings.category_link | default: '/collections/all' }}" class="block text-center">
          <div class="h-20 w-20 rounded-full overflow-hidden shadow-lg mx-auto mb-2">
            {% if block.settings.category_image %}
            <img class="h-full w-full object-cover" src="{{ block.settings.category_image | image_url }}"
              alt="{{ block.settings.category_title }}">
            {% else %}
            <div class="h-full w-full bg-gray-200 flex items-center justify-center">
              <span class="text-gray-500 text-xs">{{ block.settings.category_title | slice: 0, 2 | upcase }}</span>
            </div>
            {% endif %}
          </div>
          <h3 class="text-xs font-medium uppercase">{{ block.settings.category_title }}</h3>
        </a>
      </div>
      {% endfor %}
      {% for block in section.blocks %}
      <div class="category-item flex-shrink-0 w-20">
        <a href="{{ block.settings.category_link | default: '/collections/all' }}" class="block text-center">
          <div class="h-20 w-20 rounded-full overflow-hidden shadow-lg mx-auto mb-2">
            {% if block.settings.category_image %}
            <img class="h-full w-full object-cover" src="{{ block.settings.category_image | image_url }}"
              alt="{{ block.settings.category_title }}">
            {% else %}
            <div class="h-full w-full bg-gray-200 flex items-center justify-center">
              <span class="text-gray-500 text-xs">{{ block.settings.category_title | slice: 0, 2 | upcase }}</span>
            </div>
            {% endif %}
          </div>
          <h3 class="text-xs font-medium uppercase">{{ block.settings.category_title }}</h3>
        </a>
      </div>
      {% endfor %}
      {% else %}
      {% for category in default_categories %}
      <div class="category-item flex-shrink-0 w-20">
        <a href="/collections/{{ category | downcase | replace: ' ', '-' | replace: '&', 'and' }}"
          class="block text-center">
          <div
            class="h-20 w-20 rounded-full overflow-hidden shadow-lg mx-auto mb-2 bg-gray-200 flex items-center justify-center">
            <span class="text-gray-500 text-sm font-bold">{{ category | slice: 0, 2 | upcase }}</span>
          </div>
          <h3 class="text-xs font-medium uppercase">{{ category }}</h3>
        </a>
      </div>
      {% endfor %}
      {% for category in default_categories %}
      <div class="category-item flex-shrink-0 w-20">
        <a href="/collections/{{ category | downcase | replace: ' ', '-' | replace: '&', 'and' }}"
          class="block text-center">
          <div
            class="h-20 w-20 rounded-full overflow-hidden shadow-lg mx-auto mb-2 bg-gray-200 flex items-center justify-center">
            <span class="text-gray-500 text-sm font-bold">{{ category | slice: 0, 2 | upcase }}</span>
          </div>
          <h3 class="text-xs font-medium uppercase">{{ category }}</h3>
        </a>
      </div>
      {% endfor %}
      {% endif %}
    </div>
  </div>

  {% stylesheet %}
  .category-carousel {
    scrollbar-width: none;
    -ms-overflow-style: none;
  }
  .category-carousel::-webkit-scrollbar {
    display: none;
  }
  {% endstylesheet %}

  {% javascript %}
  document.addEventListener('DOMContentLoaded', function() {
    const carousel = document.querySelector('.category-carousel');
    const track = document.querySelector('.category-track');
    const items = track.children;
    const itemCount = items.length / 2; // Half are duplicates
    
    carousel.addEventListener('scroll', function() {
      const scrollLeft = carousel.scrollLeft;
      const maxScroll = track.scrollWidth - carousel.clientWidth;
      const itemWidth = items[0].offsetWidth + 16; // width + gap
      
      // If scrolled to end, jump to beginning
      if (scrollLeft >= maxScroll - 10) {
        carousel.scrollLeft = scrollLeft - (itemCount * itemWidth);
      }
      // If scrolled to beginning, jump to end
      else if (scrollLeft <= 10) {
        carousel.scrollLeft = scrollLeft + (itemCount * itemWidth);
      }
    });
  });
  {% endjavascript %}
</section>

{% schema %}
{
"name": "Category Stories",
"tag": "section",
"settings": [
{
"type": "header",
"content": "Mobile Category Stories"
}
],
"blocks": [
{
"type": "category",
"name": "Category",
"settings": [
{
"type": "image_picker",
"id": "category_image",
"label": "Category image"
},
{
"type": "text",
"id": "category_title",
"label": "Category title"
},
{
"type": "url",
"id": "category_link",
"label": "Category link"
}
]
}
],
"max_blocks": 10,
"presets": [
{
"name": "Category Stories",
"category": "Collections"
}
]
}
{% endschema %}